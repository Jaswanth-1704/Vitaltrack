<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroTrack - Daily Water Intake</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #3498db; /* Bright Blue */
            --secondary-color: #2ecc71; /* Green */
            --background-color: #ecf0f1; /* Light Grey */
            --container-bg: #ffffff; /* White */
            --text-color: #34495e; /* Dark Blue/Grey */
            --light-text-color: #7f8c8d; /* Medium Grey */
            --border-radius: 15px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --wave-color: rgba(52, 152, 219, 0.7);
            --wave-bg: #e0f7fa;
        }

        /* Dark Theme Variables */
        body.dark-theme {
            --primary-color: #5dade2; /* Lighter Blue for Dark Mode */
            --secondary-color: #58d68d; /* Lighter Green */
            --background-color: #2c3e50; /* Dark Blue/Grey */
            --container-bg: #34495e; /* Slightly Lighter Dark Blue/Grey */
            --text-color: #ecf0f1; /* Light Grey */
            --light-text-color: #bdc3c7; /* Lighter Medium Grey */
            --wave-color: rgba(93, 173, 226, 0.6);
            --wave-bg: #21618C;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        body.dark-theme {
             background-image: linear-gradient(120deg, #2c3e50 0%, #465669 100%);
        }


        .container {
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 700px;
            margin-top: 20px;
            text-align: center;
            transition: transform 0.3s ease-in-out, background-color 0.3s;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header h1 .icon { /* SVG icon for header */
            width: 40px;
            height: 40px;
            margin-right: 10px;
            animation: bounceIcon 2s infinite;
            fill: var(--primary-color); /* Make SVG color dynamic */
        }

        @keyframes bounceIcon {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        .water-input-section, .hydration-status-section, .history-section, .settings-section, .achievements-section, .additional-features {
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1); /* More subtle background for sections */
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
        }
        body.dark-theme .water-input-section,
        body.dark-theme .hydration-status-section,
        body.dark-theme .history-section,
        body.dark-theme .settings-section,
        body.dark-theme .achievements-section,
        body.dark-theme .additional-features {
            background-color: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255,255,255,0.08);
        }


        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.8em;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 5px;
            display: inline-block;
        }

        .input-area label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 600;
            text-align: left;
        }

        .input-area input[type="number"], .input-area select {
            width: 100%; /* Full width for better mobile */
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            background-color: var(--container-bg); /* Match container for theme */
            color: var(--text-color);
        }
        body.dark-theme .input-area input[type="number"],
        body.dark-theme .input-area select {
            border-color: #555;
        }


        .input-area input[type="number"]:focus, .input-area select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
        }

        .quick-add-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-add-btn, .action-btn, .history-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .quick-add-btn .icon, .action-btn .icon, .history-btn .icon { /* SVG icons for buttons */
            width: 20px;
            height: 20px;
            fill: white; /* Ensure icon color contrasts with button */
        }


        .quick-add-btn:hover, .action-btn:hover, .history-btn:hover {
            background-color: #2980b9; /* Darker shade of primary */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
         .quick-add-btn:active, .action-btn:active, .history-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }


        .status-display {
            background-color: rgba(249,249,249, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        body.dark-theme .status-display {
            background-color: rgba(40, 50, 60, 0.8);
        }


        .status-display p {
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .status-display strong {
            color: var(--secondary-color);
            font-size: 1.3em;
        }

        .hydration-level-visual {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            position: relative;
        }

        .hydration-bar-container {
            width: 100%;
            height: 40px;
            background-color: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        body.dark-theme .hydration-bar-container {
            background-color: #555;
        }

        .hydration-bar {
            width: 0%; /* Updated by JS */
            height: 100%;
            background-image: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            border-radius: 20px 0 0 20px;
            transition: width 0.5s ease-out, background-color 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }

        .hydration-text {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            color: var(--text-color);
            font-weight: 600;
        }

        .water-wave-mockup {
            width: 150px;
            height: 150px;
            margin: 30px auto 20px; /* Added more margin top */
            border-radius: 50%;
            background-color: var(--wave-bg);
            position: relative;
            overflow: hidden;
            border: 5px solid var(--primary-color);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%; /* Controlled by JS */
            background-color: var(--wave-color);
            transition: height 1s ease-out;
        }
        .wave::before, .wave::after { /* Pseudo-elements for wave effect */
            content: "";
            position: absolute;
            width: 200%;
            height: 150px; /* Increased height for more pronounced wave */
            top: -75px; /* Adjusted top position */
            left: -50%;
            background: transparent; /* Transparent background, shape made by border-radius */
            opacity: 0.5;
            animation: wave-animation 7s infinite linear;
            border-radius: 45%;
        }

        .wave::before {
            background-color: rgba(255,255,255,0.3); /* Lighter part of wave */
            animation-duration: 7s; /* Synchronized duration */
            animation-direction: alternate-reverse; /* Different direction for variation */
        }
        .wave::after {
            background-color: rgba(255,255,255,0.15); /* Even lighter part of wave */
            animation-duration: 10s; /* Different duration for complexity */
            animation-direction: alternate;
        }

        @keyframes wave-animation { /* Simplified wave animation */
            0% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(-25%) rotate(10deg); } /* Adjusted transform */
            100% { transform: translateX(0) rotate(0deg); }
        }


        .history-log {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 8px;
            background-color: var(--container-bg); /* Theme-aware */
        }
        body.dark-theme .history-log {
            border-color: #555;
        }

        .history-log p {
            padding: 8px;
            border-bottom: 1px dashed #eee;
            font-size: 0.95em;
            color: var(--light-text-color);
            text-align: left;
        }
        body.dark-theme .history-log p {
            border-bottom-color: #444;
        }
        .history-log p:last-child {
            border-bottom: none;
        }
        .history-log p .timestamp {
            font-size: 0.8em;
            margin-left: 10px;
            color: #95a5a6;
        }
        body.dark-theme .history-log p .timestamp {
            color: #777;
        }

        /* Modal for Reminders & Tips */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Darker overlay */
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--container-bg);
            margin: 10% auto; /* Adjusted margin for better centering */
            padding: 25px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: var(--box-shadow);
            animation: slideIn 0.4s ease-out;
            position: relative;
        }

        .close-btn {
            color: var(--light-text-color);
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover, .close-btn:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .settings-section .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0; /* Increased padding */
            border-bottom: 1px solid #eee;
        }
        body.dark-theme .settings-section .setting-item {
            border-bottom-color: #444;
        }
        .settings-section .setting-item:last-child {
            border-bottom: none;
        }
        .settings-section label {
            font-weight: normal;
            color: var(--text-color);
        }

        /* Toggle Switch */
        .switch {
          position: relative;
          display: inline-block;
          width: 50px;
          height: 24px;
        }
        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }
        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 24px;
        }
        .slider:before {
          position: absolute;
          content: "";
          height: 18px;
          width: 18px;
          left: 3px;
          bottom: 3px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }
        input:checked + .slider {
          background-color: var(--secondary-color);
        }
        input:checked + .slider:before {
          transform: translateX(26px);
        }

        .achievement {
            display: flex;
            align-items: center;
            padding: 12px; /* Increased padding */
            margin-bottom: 10px;
            background-color: #f0f0f0;
            border-radius: 10px; /* Slightly more rounded */
            transition: transform 0.2s ease, background-color 0.3s;
            border: 1px solid transparent;
        }
        body.dark-theme .achievement {
            background-color: #4a5a6a;
            border-color: #5a6a7a;
        }

        .achievement.unlocked {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        body.dark-theme .achievement.unlocked {
             background-color: var(--secondary-color); /* Keep green for unlocked in dark mode too */
        }

        .achievement.unlocked .icon {
            filter: brightness(0) invert(1);
        }
        body.dark-theme .achievement .icon { /* Default icon color in dark mode */
             filter: brightness(0.8) invert(0.1);
        }
        body.dark-theme .achievement.unlocked .icon { /* Unlocked icon in dark mode */
             filter: brightness(0) invert(1);
        }


        .achievement:hover {
            transform: scale(1.03);
        }
        .achievement .icon { /* SVG icon for achievements */
            width: 30px;
            height: 30px;
            margin-right: 15px;
            fill: var(--light-text-color); /* Default color */
            transition: fill 0.3s;
        }
        .achievement.unlocked .icon {
            fill: white; /* Color for unlocked achievement icon */
        }

        .achievement-details h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
        }
        .achievement-details p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Achievement Toast */
        .achievement-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            font-size: 1.1em;
            text-align: center;
        }


        /* Footer */
        footer {
            margin-top: 30px;
            font-size: 0.9em;
            color: var(--light-text-color);
        }
        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin-top: 10px;
            }
            header h1 {
                font-size: 2em;
            }
             .quick-add-buttons {
                flex-direction: column; /* Stack buttons on small screens */
            }
            .quick-add-btn, .action-btn {
                width: 100%; /* Full width buttons */
                justify-content: center;
                margin-bottom: 8px;
            }
            .modal-content {
                margin: 20% auto;
                width: 95%;
            }
            .hydration-bar-container {
                height: 30px;
            }
            .water-wave-mockup {
                width: 120px;
                height: 120px;
            }
            .settings-section .setting-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .settings-section .setting-item .switch {
                margin-top: 8px;
            }
        }

    </style>
</head>
<body>
    <div class="container animate__animated animate__fadeInDown">
        <header>
            <h1>
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2c-5.33 4.55-5.33 11.45 0 16 5.33-4.55 5.33-11.45 0-16zm0 14c-1.67-2.02-2.67-4.12-2.67-6 0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.88-1 3.98-2.67 6h-2.66z"/>
                    <path d="M0 0h24v24H0z" fill="none"/>
                </svg>
                HydroTrack
            </h1>
            <p style="color: var(--light-text-color); font-size: 1.1em;">Stay Refreshed, Stay Healthy!</p>
        </header>

        <section class="water-input-section animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
            <h2>Log Your Intake</h2>
            <div class="input-area">
                <label for="waterAmount">Add Water (ml):</label>
                <input type="number" id="waterAmount" placeholder="e.g., 250" min="0">

                <label for="drinkType">Beverage Type:</label>
                <select id="drinkType">
                    <option value="water" data-hydration="1">Water (100% Hydration)</option>
                    <option value="tea" data-hydration="0.9">Tea (90% Hydration)</option>
                    <option value="coffee" data-hydration="0.8">Coffee (80% Hydration)</option>
                    <option value="juice" data-hydration="0.85">Juice (85% Hydration)</option>
                    <option value="milk" data-hydration="0.95">Milk (95% Hydration)</option>
                    <option value="sports_drink" data-hydration="1.05">Sports Drink (105% Hydration)</option>
                </select>

                <button id="addWaterBtn" class="action-btn">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    Add Drink
                </button>
            </div>
            <div class="quick-add-buttons">
                <button class="quick-add-btn" data-amount="250" data-type="water">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M4 11h16v2H4zm13-7h-2V1h-2v3H7v2h10V4zm2 10.5c-1.68 0-3 1.32-3 3s1.32 3 3 3 3-1.32 3-3-1.32-3-3-3zm0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zM4 19h10v-7H4v7zm2-5h6v3H6v-3z"/></svg> Glass (250ml)
                </button>
                <button class="quick-add-btn" data-amount="500" data-type="water">
                     <svg class="icon" viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h5v2H8v-2z"/></svg> Bottle (500ml)
                </button>
                 <button class="quick-add-btn" data-amount="750" data-type="water">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h5v2H8v-2z"/></svg> Large Bottle (750ml)
                </button>
            </div>
        </section>

        <section class="hydration-status-section animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
            <h2>Today's Hydration</h2>
            <div class="status-display">
                <p>Glasses (250ml equiv.) Today: <strong id="glassesToday">0</strong></p>
                <p>Total Effective Intake: <strong id="totalWaterToday">0</strong> ml / <span id="dailyGoalDisplay">2000</span> ml</p>
            </div>

            <div class="hydration-text" id="hydrationLevelText">Hydration Level: 0%</div>
            <div class="hydration-bar-container">
                <div class="hydration-bar" id="hydrationProgressBar"></div>
            </div>

            <div class="water-wave-mockup">
                <div class="wave" id="waterWave"></div>
                <div style="position: absolute; top:50%; left:50%; transform: translate(-50%, -50%); font-size:1.5em; color: var(--primary-color); font-weight:bold; text-shadow: 0 0 5px rgba(255,255,255,0.7);" id="wavePercentage">0%</div>
            </div>

            <canvas id="hydrationChart" height="150"></canvas>
        </section>

        <section class="additional-features animate__animated animate__fadeInUp" style="animation-delay: 0.6s;">
            <h2>Tools & Insights</h2>
            <div class="quick-add-buttons">
                 <button class="action-btn" id="showRemindersBtn">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                    Set Reminders
                </button>
                <button class="action-btn" id="showTipsBtn">
                     <svg class="icon" viewBox="0 0 24 24"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1V9H9v12zm3-19c-1.66 0-3 1.34-3 3v1h6V5c0-1.66-1.34-3-3-3zM5 7V5c0-2.76 2.24-5 5-5s5 2.24 5 5v2H5z"/></svg>
                    Hydration Tips
                </button>
            </div>
        </section>

        <section class="history-section animate__animated animate__fadeInUp" style="animation-delay: 0.8s;">
            <h2>Intake History</h2>
            <div id="historyLog" class="history-log">
                <p>No entries yet for today.</p>
            </div>
            <button id="clearHistoryBtn" class="history-btn" style="margin-top:15px; background-color: #e74c3c;">
                <svg class="icon" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                Clear Today's History
            </button>
        </section>

        <section class="settings-section animate__animated animate__fadeInUp" style="animation-delay: 1s;">
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="dailyGoalInput">Daily Goal (ml):</label>
                <input type="number" id="dailyGoalInput" value="2000" style="width: 100px; padding: 8px; text-align: right;">
            </div>
            <div class="setting-item">
                <label for="enableReminders">Enable Drink Reminders:</label>
                <label class="switch">
                    <input type="checkbox" id="enableReminders">
                    <span class="slider"></span>
                </label>
            </div>
             <div class="setting-item">
                <label for="themeToggle">Dark Mode:</label>
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </section>

         <section class="achievements-section animate__animated animate__fadeInUp" style="animation-delay: 1.2s;">
            <h2>Achievements</h2>
            <div id="achievementsList">
                <div class="achievement" id="ach_first_drink">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> <div class="achievement-details">
                        <h4>First Drop!</h4>
                        <p>Log your first drink of the day.</p>
                    </div>
                </div>
                 <div class="achievement" id="ach_half_goal">
                     <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18V4c4.41 0 8 3.59 8 8s-3.59 8-8 8z"/></svg> <div class="achievement-details">
                        <h4>Halfway There!</h4>
                        <p>Reach 50% of your daily goal.</p>
                    </div>
                </div>
                 <div class="achievement" id="ach_full_goal">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg> <div class="achievement-details">
                        <h4>Goal Achieved!</h4>
                        <p>Meet your daily hydration goal.</p>
                    </div>
                </div>
                 <div class="achievement" id="ach_streak_3">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M21 11.01L12.06 2.06 3.11 11.01 3.11 20H7.11V14H11.11V20H15.11V14H19.11V20H21V11.01ZM12.06 4.88L17.17 10H15.11V12H13.11V10H11.11V12H9.11V10H7.01L12.06 4.88Z"/></svg> <div class="achievement-details">
                        <h4>3-Day Streak!</h4>
                        <p>Meet your goal for 3 days in a row.</p>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <div id="remindersModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeRemindersModal">&times;</span>
            <h2>Set Drink Reminders</h2>
            <p>Enable reminders and set an interval. Browser notifications will be used if permission is granted.</p>
            <div class="input-area" style="margin-top: 15px;">
                <label for="reminderInterval">Remind me every (minutes):</label>
                <input type="number" id="reminderInterval" value="60" min="10" style="width:100px; padding: 8px;">
            </div>
            <button class="action-btn" id="saveReminderSettings" style="margin-top: 10px;">
                <svg class="icon" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
                Save Settings
            </button>
            <p id="reminderStatus" style="margin-top:10px; color: var(--secondary-color);"></p>
        </div>
    </div>

    <div id="tipsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeTipsModal">&times;</span>
            <h2>Hydration Tip</h2>
            <ul id="hydrationTipsList" style="list-style: none; padding: 0;">
                </ul>
             <button class="action-btn" id="refreshTipBtn" style="margin-top:15px;">
                <svg class="icon" viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                Show Another Tip
            </button>
        </div>
    </div>

    <footer>
        <p>&copy; <span id="currentYear"></span> HydroTrack. Designed with <span style="color: #e74c3c;">&hearts;</span>. <a href="#" id="privacyPolicyLink">Privacy Policy</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const waterAmountInput = document.getElementById('waterAmount');
            const drinkTypeSelect = document.getElementById('drinkType');
            const addWaterBtn = document.getElementById('addWaterBtn');
            const quickAddButtons = document.querySelectorAll('.quick-add-btn');
            const glassesTodayDisplay = document.getElementById('glassesToday');
            const totalWaterTodayDisplay = document.getElementById('totalWaterToday');
            const dailyGoalDisplay = document.getElementById('dailyGoalDisplay');
            const hydrationProgressBar = document.getElementById('hydrationProgressBar');
            const hydrationLevelText = document.getElementById('hydrationLevelText');
            const waterWave = document.getElementById('waterWave');
            const wavePercentage = document.getElementById('wavePercentage');
            const historyLog = document.getElementById('historyLog');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const dailyGoalInput = document.getElementById('dailyGoalInput');
            const enableRemindersSwitch = document.getElementById('enableReminders');
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;

            // Modals & Related Elements
            const remindersModal = document.getElementById('remindersModal');
            const tipsModal = document.getElementById('tipsModal');
            const showRemindersBtn = document.getElementById('showRemindersBtn');
            const showTipsBtn = document.getElementById('showTipsBtn');
            const closeRemindersModal = document.getElementById('closeRemindersModal');
            const closeTipsModal = document.getElementById('closeTipsModal');
            const refreshTipBtn = document.getElementById('refreshTipBtn');
            const reminderIntervalInput = document.getElementById('reminderInterval');
            const saveReminderSettingsBtn = document.getElementById('saveReminderSettings');
            const reminderStatus = document.getElementById('reminderStatus');

            // State Variables
            let totalWaterIntake = 0;
            let dailyGoal = 2000; // Default daily goal
            let intakeHistory = [];
            let achievements = {
                ach_first_drink: false,
                ach_half_goal: false,
                ach_full_goal: false,
                ach_streak_3: false // Streak logic requires more complex date tracking
            };
            let reminderIntervalId = null;
            let hydrationChart; // For Chart.js instance

            // --- Initialization ---
            function initializeApp() {
                loadData(); // Load data from localStorage
                updateDisplay(); // Initial UI update
                requestNotificationPermission(); // Ask for notification permission early
                document.getElementById('currentYear').textContent = new Date().getFullYear();
            }

            // --- Data Persistence (localStorage) ---
            function saveData() {
                localStorage.setItem('hydroTrack_totalWaterIntake', totalWaterIntake);
                localStorage.setItem('hydroTrack_dailyGoal', dailyGoal);
                localStorage.setItem('hydroTrack_intakeHistory', JSON.stringify(intakeHistory));
                localStorage.setItem('hydroTrack_achievements', JSON.stringify(achievements));
                localStorage.setItem('hydroTrack_lastTrackDate', new Date().toLocaleDateString());
                localStorage.setItem('hydroTrack_theme', body.classList.contains('dark-theme') ? 'dark' : 'light');
                localStorage.setItem('hydroTrack_reminderInterval', reminderIntervalInput.value);
                localStorage.setItem('hydroTrack_remindersEnabled', enableRemindersSwitch.checked);
            }

            function loadData() {
                const today = new Date().toLocaleDateString();
                const lastTrackDate = localStorage.getItem('hydroTrack_lastTrackDate');

                dailyGoal = parseInt(localStorage.getItem('hydroTrack_dailyGoal')) || 2000;
                dailyGoalInput.value = dailyGoal;

                if (lastTrackDate === today) {
                    totalWaterIntake = parseInt(localStorage.getItem('hydroTrack_totalWaterIntake')) || 0;
                    intakeHistory = JSON.parse(localStorage.getItem('hydroTrack_intakeHistory')) || [];
                    achievements = JSON.parse(localStorage.getItem('hydroTrack_achievements')) || achievements;
                } else {
                    // New day, reset daily progress but keep goal and theme
                    totalWaterIntake = 0;
                    intakeHistory = [];
                    achievements.ach_first_drink = false;
                    achievements.ach_half_goal = false;
                    achievements.ach_full_goal = false;
                    // Note: True streak logic would require checking consecutive days of meeting goals.
                }

                // Load theme
                if (localStorage.getItem('hydroTrack_theme') === 'dark') {
                    body.classList.add('dark-theme');
                    themeToggle.checked = true;
                }

                // Load reminder settings
                reminderIntervalInput.value = localStorage.getItem('hydroTrack_reminderInterval') || '60';
                enableRemindersSwitch.checked = localStorage.getItem('hydroTrack_remindersEnabled') === 'true';
                if (enableRemindersSwitch.checked) {
                    startReminders(); // Re-initialize reminders if they were enabled
                }

                loadAchievementsStatus();
            }

            // --- Core Logic ---
            function addWater(amount, type, hydrationFactor) {
                if (isNaN(amount) || amount <= 0) {
                    showToast("Please enter a valid amount.", "error");
                    return;
                }
                const effectiveAmount = Math.round(amount * hydrationFactor);
                totalWaterIntake += effectiveAmount;
                const now = new Date();
                intakeHistory.push({
                    amount: amount,
                    effectiveAmount: effectiveAmount,
                    type: type.charAt(0).toUpperCase() + type.slice(1).replace('_', ' '),
                    time: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    timestamp: now.toISOString()
                });
                waterAmountInput.value = ''; // Clear input
                triggerInputAnimation(effectiveAmount, type);
                updateDisplay();
            }

            function updateDisplay() {
                const glassesEquivalent = Math.floor(totalWaterIntake / 250); // Assuming 250ml is a glass
                glassesTodayDisplay.textContent = glassesEquivalent;
                totalWaterTodayDisplay.textContent = `${totalWaterIntake} ml / ${dailyGoal} ml`;

                const percentage = Math.min((totalWaterIntake / dailyGoal) * 100, 100);
                hydrationProgressBar.style.width = `${percentage}%`;
                hydrationProgressBar.textContent = `${Math.round(percentage)}%`;
                hydrationLevelText.textContent = `Hydration Level: ${Math.round(percentage)}%`;

                // Water Wave Mockup
                waterWave.style.height = `${percentage}%`;
                wavePercentage.textContent = `${Math.round(percentage)}%`;

                // Progress bar color change based on completion
                if (percentage >= 100) {
                    hydrationProgressBar.style.backgroundImage = `linear-gradient(45deg, var(--secondary-color), #58d68d)`; // More vibrant green
                } else if (percentage >= 50) {
                    hydrationProgressBar.style.backgroundImage = `linear-gradient(45deg, var(--secondary-color), var(--primary-color))`;
                } else {
                    hydrationProgressBar.style.backgroundImage = `linear-gradient(45deg, var(--primary-color), #5dade2)`; // Shades of blue
                }

                updateHistoryLog();
                updateChart();
                checkAchievements();
                saveData();
            }

            function updateHistoryLog() {
                historyLog.innerHTML = '';
                if (intakeHistory.length === 0) {
                    historyLog.innerHTML = '<p>No entries yet for today.</p>';
                    return;
                }
                intakeHistory.slice().reverse().forEach(entry => { // Show latest first
                    const p = document.createElement('p');
                    p.innerHTML = `Logged <strong>${entry.amount}ml</strong> of ${entry.type} (Effective: ${entry.effectiveAmount}ml) <span class="timestamp">at ${entry.time}</span>`;
                    p.classList.add('animate__animated', 'animate__fadeIn');
                    historyLog.appendChild(p);
                });
            }

            // --- Event Listeners ---
            addWaterBtn.addEventListener('click', () => {
                const amount = parseInt(waterAmountInput.value);
                const selectedOption = drinkTypeSelect.options[drinkTypeSelect.selectedIndex];
                const type = selectedOption.value;
                const hydrationFactor = parseFloat(selectedOption.dataset.hydration);
                addWater(amount, type, hydrationFactor);
            });

            quickAddButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const amount = parseInt(button.dataset.amount);
                    const type = button.dataset.type;
                    // Find the hydration factor for the quick add type (default to water if not specified)
                    let hydrationFactor = 1;
                    const option = Array.from(drinkTypeSelect.options).find(opt => opt.value === type);
                    if (option) {
                        hydrationFactor = parseFloat(option.dataset.hydration);
                    }
                    addWater(amount, type, hydrationFactor);
                });
            });

            clearHistoryBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear today\'s intake history? This cannot be undone.')) {
                    totalWaterIntake = 0;
                    intakeHistory = [];
                    // Reset daily achievements
                    achievements.ach_first_drink = false;
                    achievements.ach_half_goal = false;
                    achievements.ach_full_goal = false;
                    loadAchievementsStatus(); // Reflect reset in UI
                    updateDisplay();
                }
            });

            dailyGoalInput.addEventListener('change', () => {
                const newGoal = parseInt(dailyGoalInput.value);
                if (!isNaN(newGoal) && newGoal > 0) {
                    dailyGoal = newGoal;
                    updateDisplay();
                } else {
                    dailyGoalInput.value = dailyGoal; // Reset to old value if invalid
                    showToast("Invalid goal. Please enter a positive number.", "error");
                }
            });

            themeToggle.addEventListener('change', () => {
                body.classList.toggle('dark-theme');
                saveData(); // Save theme preference
                updateChart(); // Re-render chart with new theme colors if needed
            });

            // Modal Handling
            showRemindersBtn.addEventListener('click', () => remindersModal.style.display = 'block');
            showTipsBtn.addEventListener('click', () => {
                displayRandomTip();
                tipsModal.style.display = 'block';
            });
            closeRemindersModal.addEventListener('click', () => remindersModal.style.display = 'none');
            closeTipsModal.addEventListener('click', () => tipsModal.style.display = 'none');
            window.addEventListener('click', (event) => {
                if (event.target === remindersModal) remindersModal.style.display = 'none';
                if (event.target === tipsModal) tipsModal.style.display = 'none';
            });

            // --- Hydration Tips ---
            const tips = [
                "Carry a reusable water bottle with you everywhere.",
                "Drink water before, during, and after workouts.",
                "Thirsty? You might already be slightly dehydrated. Drink up!",
                "Set reminders on your phone or use this app's feature!",
                "Flavor water with lemon, cucumber, or berries for variety.",
                "Eat water-rich foods like watermelon and cucumbers.",
                "Start your day with a glass of water to kickstart hydration.",
                "Monitor urine color: pale yellow means good hydration.",
                "Drink water even when it's cold outside.",
                "If you drink coffee or tea, balance it with extra water."
            ];
            const hydrationTipsList = document.getElementById('hydrationTipsList');
            function displayRandomTip() {
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                hydrationTipsList.innerHTML = `<li style="padding: 8px 0; font-size: 1.1em; text-align:center;">${randomTip}</li>`;
            }
            refreshTipBtn.addEventListener('click', displayRandomTip);

            // --- Reminder Logic ---
            function requestNotificationPermission() {
                if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showToast("Notification permission granted!", "success");
                        }
                    });
                }
            }

            enableRemindersSwitch.addEventListener('change', () => {
                if (enableRemindersSwitch.checked) {
                    if (Notification.permission !== 'granted') {
                        requestNotificationPermission();
                         showToast("Please grant notification permission for reminders.", "info");
                    }
                    startReminders();
                    reminderStatus.textContent = `Reminders enabled. Next in ~${reminderIntervalInput.value} min.`;
                } else {
                    stopReminders();
                    reminderStatus.textContent = 'Reminders disabled.';
                }
                saveData();
            });

            saveReminderSettingsBtn.addEventListener('click', () => {
                 if (enableRemindersSwitch.checked) {
                    stopReminders();
                    startReminders();
                    reminderStatus.textContent = `Settings saved. Reminders active. Next in ~${reminderIntervalInput.value} min.`;
                    showToast("Reminder settings saved!", "success");
                 } else {
                    reminderStatus.textContent = 'Enable reminders to save interval.';
                    showToast("Enable reminders first to save settings.", "info");
                 }
                 remindersModal.style.display = 'none';
                 saveData();
            });

            function startReminders() {
                const intervalMinutes = parseInt(reminderIntervalInput.value);
                if (isNaN(intervalMinutes) || intervalMinutes <= 0) {
                    showToast("Invalid reminder interval.", "error");
                    return;
                }
                const intervalMs = intervalMinutes * 60000;
                stopReminders(); // Clear any existing reminder
                reminderIntervalId = setInterval(() => {
                    if (Notification.permission === "granted") {
                        new Notification("HydroTrack Reminder ðŸ’§", {
                            body: "Time to drink some water! Stay hydrated.",
                            icon: 'https://placehold.co/48x48/3498db/ffffff?text=ðŸ’§' // Placeholder icon
                        });
                    } else {
                        // Fallback if notifications not granted after initial check
                        console.log("Reminder: Time to hydrate! (Notifications not granted)");
                    }
                }, intervalMs);
            }

            function stopReminders() {
                if (reminderIntervalId) {
                    clearInterval(reminderIntervalId);
                    reminderIntervalId = null;
                }
            }

            // --- Achievements ---
            function checkAchievements() {
                if (intakeHistory.length > 0 && !achievements.ach_first_drink) {
                    unlockAchievement('ach_first_drink', "First Drop!", "You've logged your first drink!");
                }
                if (totalWaterIntake >= dailyGoal / 2 && !achievements.ach_half_goal) {
                     unlockAchievement('ach_half_goal', "Halfway There!", "Awesome! 50% of your goal reached.");
                }
                if (totalWaterIntake >= dailyGoal && !achievements.ach_full_goal) {
                    unlockAchievement('ach_full_goal', "Goal Achieved!", "Congratulations! Daily goal met!");
                }
                // Streak logic is more complex and would typically involve checking localStorage for previous days' completion.
                // For this example, ach_streak_3 remains conceptual or tied to a simpler trigger.
            }

            function unlockAchievement(id, title, message) {
                if (achievements[id]) return; // Already unlocked

                achievements[id] = true;
                const achElement = document.getElementById(id);
                if (achElement) {
                    achElement.classList.add('unlocked', 'animate__animated', 'animate__tada');
                    // The icon fill is now handled by CSS :.unlocked .icon
                }
                showToast(`ðŸ† Achievement: ${title}`, "success", 4000);
                saveData();
            }

            function loadAchievementsStatus() {
                Object.keys(achievements).forEach(key => {
                    const achElement = document.getElementById(key);
                    if (achElement) {
                        if (achievements[key]) {
                            achElement.classList.add('unlocked');
                        } else {
                            achElement.classList.remove('unlocked');
                        }
                    }
                });
            }

            // --- Chart.js Integration ---
            function updateChart() {
                const labels = intakeHistory.map(entry => entry.time);
                let cumulativeIntake = 0;
                const dataPoints = intakeHistory.map(entry => {
                    cumulativeIntake += entry.effectiveAmount;
                    return cumulativeIntake;
                });

                const chartColors = body.classList.contains('dark-theme') ?
                    {
                        borderColor: 'rgba(93, 173, 226, 1)', // Lighter blue
                        backgroundColor: 'rgba(93, 173, 226, 0.2)',
                        pointColor: 'rgba(88, 214, 141, 1)', // Lighter green
                        gridColor: 'rgba(255, 255, 255, 0.1)',
                        ticksColor: 'rgba(236, 240, 241, 0.8)'
                    } : {
                        borderColor: 'var(--primary-color)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        pointColor: 'var(--secondary-color)',
                        gridColor: 'rgba(0, 0, 0, 0.05)',
                        ticksColor: 'var(--text-color)'
                    };

                if (hydrationChart) {
                    hydrationChart.data.labels = labels;
                    hydrationChart.data.datasets[0].data = dataPoints;
                    hydrationChart.data.datasets[0].borderColor = chartColors.borderColor;
                    hydrationChart.data.datasets[0].backgroundColor = chartColors.backgroundColor;
                    hydrationChart.data.datasets[0].pointBackgroundColor = chartColors.pointColor;
                    hydrationChart.data.datasets[0].pointBorderColor = chartColors.pointColor;
                    hydrationChart.options.scales.y.grid.color = chartColors.gridColor;
                    hydrationChart.options.scales.x.grid.color = chartColors.gridColor;
                    hydrationChart.options.scales.y.ticks.color = chartColors.ticksColor;
                    hydrationChart.options.scales.x.ticks.color = chartColors.ticksColor;
                    hydrationChart.update();
                } else {
                    const ctx = document.getElementById('hydrationChart').getContext('2d');
                    hydrationChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Cumulative Intake (ml)',
                                data: dataPoints,
                                borderColor: chartColors.borderColor,
                                backgroundColor: chartColors.backgroundColor,
                                fill: true,
                                tension: 0.3,
                                pointBackgroundColor: chartColors.pointColor,
                                pointBorderColor: chartColors.pointColor,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Total Intake (ml)', color: chartColors.ticksColor },
                                    grid: { color: chartColors.gridColor },
                                    ticks: { color: chartColors.ticksColor }
                                },
                                x: {
                                    title: { display: true, text: 'Time', color: chartColors.ticksColor },
                                    grid: { color: chartColors.gridColor },
                                    ticks: { color: chartColors.ticksColor }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: chartColors.ticksColor } },
                                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: 'rgba(0,0,0,0.7)'}
                            }
                        }
                    });
                }
            }

            // --- UI Enhancements ---
            function triggerInputAnimation(amount, type) {
                const effectText = `+${amount}ml (${type.replace('_', ' ')})`;
                showToast(effectText, "log", 2000); // Using toast for this effect
            }

            function showToast(message, type = "info", duration = 3000) {
                const existingToast = document.querySelector('.toast-notification');
                if(existingToast) existingToast.remove();

                const toast = document.createElement('div');
                toast.className = `toast-notification animate__animated animate__fadeInUp ${type}`;
                toast.textContent = message;

                let backgroundColor = 'var(--primary-color)';
                if (type === 'success') backgroundColor = 'var(--secondary-color)';
                if (type === 'error') backgroundColor = '#e74c3c'; // Red for error
                if (type === 'log') backgroundColor = '#8e44ad'; // Purple for log

                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: ${backgroundColor};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                    z-index: 9999;
                    font-size: 0.95em;
                    text-align: center;
                    opacity: 0.95;
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.classList.remove('animate__fadeInUp');
                    toast.classList.add('animate__fadeOutDown');
                    setTimeout(() => toast.remove(), 500);
                }, duration);
            }

            // Privacy Policy Link
            document.getElementById('privacyPolicyLink').addEventListener('click', (e) => {
                e.preventDefault();
                showToast("Privacy: All data is stored locally in your browser.", "info", 5000);
            });

            // --- Start the application ---
            initializeApp();
        });
    </script>
</body>
</html>
